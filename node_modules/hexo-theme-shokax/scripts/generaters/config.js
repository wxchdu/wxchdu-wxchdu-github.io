'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/* global hexo */
const hexo_util_1 = require("hexo-util");
const node_fs_1 = __importDefault(require("node:fs"));
const path_1 = __importDefault(require("path"));
const js_yaml_1 = __importDefault(require("js-yaml"));
hexo.extend.filter.register('before_generate', () => {
    if (hexo.config.theme_config) {
        // @ts-ignore
        hexo.theme.config = (0, hexo_util_1.deepMerge)(hexo.theme.config, hexo.config.theme_config);
    }
    const data = hexo.locals.get('data');
    if (data.languages) {
        // @ts-ignore
        const { i18n } = hexo.theme;
        const mergeLang = lang => {
            if (data.languages[lang]) { // @ts-ignore
                i18n.set(lang, (0, hexo_util_1.deepMerge)(i18n.get([lang]), data.languages[lang]));
            }
        };
        for (const lang of ['en', 'ja', 'zh-CN', 'zh-HK', 'zh-TW']) {
            mergeLang(lang);
        }
    }
    hexo.theme.config.style = {};
    for (const style of ['iconfont', 'colors', 'custom']) {
        const custom_file = 'source/_data/' + style + '.styl';
        if (node_fs_1.default.existsSync(custom_file)) {
            hexo.theme.config.style[style] = path_1.default.resolve(hexo.base_dir, custom_file);
        }
    }
    if (data.images && data.images.length > 0) {
        hexo.theme.config.image_list = data.images;
    }
    else {
        hexo.theme.config.image_list = js_yaml_1.default.load(node_fs_1.default.readFileSync(path_1.default.join(__dirname, '../../_images.yml'), { encoding: 'utf-8' }));
    }
    if (node_fs_1.default.existsSync(path_1.default.join(__dirname, '../../_images_index.yml'))) {
        hexo.theme.config.index_images = js_yaml_1.default.load(node_fs_1.default.readFileSync(path_1.default.join(__dirname, '../../_images_index.yml'), { encoding: 'utf-8' }));
    }
    else {
        hexo.theme.config.index_images = data.index_images || [];
    }
});
